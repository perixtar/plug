generator client {
  provider        = "prisma-client-js"
  output          = "../lib/generated/prisma"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["auth", "public"]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  instance_id                 String?   @db.Uuid
  id                          String    @id @db.Uuid
  aud                         String?   @db.VarChar(255)
  role                        String?   @db.VarChar(255)
  email                       String?   @db.VarChar(255)
  encrypted_password          String?   @db.VarChar(255)
  email_confirmed_at          DateTime? @db.Timestamptz(6)
  invited_at                  DateTime? @db.Timestamptz(6)
  confirmation_token          String?   @db.VarChar(255)
  confirmation_sent_at        DateTime? @db.Timestamptz(6)
  recovery_token              String?   @db.VarChar(255)
  recovery_sent_at            DateTime? @db.Timestamptz(6)
  email_change_token_new      String?   @db.VarChar(255)
  email_change                String?   @db.VarChar(255)
  email_change_sent_at        DateTime? @db.Timestamptz(6)
  last_sign_in_at             DateTime? @db.Timestamptz(6)
  raw_app_meta_data           Json?
  raw_user_meta_data          Json?
  is_super_admin              Boolean?
  created_at                  DateTime? @db.Timestamptz(6)
  updated_at                  DateTime? @db.Timestamptz(6)
  phone                       String?   @unique
  phone_confirmed_at          DateTime? @db.Timestamptz(6)
  phone_change                String?   @default("")
  phone_change_token          String?   @default("") @db.VarChar(255)
  phone_change_sent_at        DateTime? @db.Timestamptz(6)
  confirmed_at                DateTime? @default(dbgenerated("LEAST(email_confirmed_at, phone_confirmed_at)")) @db.Timestamptz(6)
  email_change_token_current  String?   @default("") @db.VarChar(255)
  email_change_confirm_status Int?      @default(0) @db.SmallInt
  banned_until                DateTime? @db.Timestamptz(6)
  reauthentication_token      String?   @default("") @db.VarChar(255)
  reauthentication_sent_at    DateTime? @db.Timestamptz(6)
  is_sso_user                 Boolean   @default(false)
  deleted_at                  DateTime? @db.Timestamptz(6)
  is_anonymous                Boolean   @default(false)
  profile                     profile?

  @@index([instance_id])
  @@index([is_anonymous])
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profile {
  id                   String                 @id @db.Uuid
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  onboarding_status    OnboardingStatus       @default(NOT_STARTED)
  email                String
  users                users                  @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profile_to_workspace profile_to_workspace[]
  tool                 tool[]
  tool_message         tool_message[]

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profile_to_workspace {
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  user_id      String    @db.Uuid
  workspace_id String    @db.Uuid
  profile      profile   @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "member_user_id_fkey")
  workspace    workspace @relation(fields: [workspace_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([user_id, workspace_id])
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tool {
  created_at                                              DateTime            @default(now()) @db.Timestamptz(6)
  name                                                    String
  description                                             String?
  updated_at                                              DateTime            @default(now()) @db.Timestamptz(6)
  id                                                      String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id                                            String              @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  owner_id                                                String              @db.Uuid
  icon                                                    String
  status                                                  ToolStatus
  database_id                                             String?             @db.Uuid
  current_tool_message_id                                 String?             @db.Uuid
  template_id                                             TemplateId?
  latest_code_artifact                                    Json?
  tool_message_tool_current_tool_message_idTotool_message tool_message?       @relation("tool_current_tool_message_idTotool_message", fields: [current_tool_message_id], references: [id], onDelete: Cascade)
  workspace_database                                      workspace_database? @relation(fields: [database_id], references: [id], onDelete: Cascade)
  profile                                                 profile             @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  workspace                                               workspace           @relation(fields: [workspace_id], references: [id], onDelete: Cascade)
  tool_message                                            tool_message[]
  tool_page                                               tool_page[]

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tool_message {
  created_at                                      DateTime @default(now()) @db.Timestamptz(6)
  user_id                                         String?  @db.Uuid
  role                                            String?
  content                                         Json?
  execution_result                                Json?
  id                                              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tool_id                                         String   @db.Uuid
  code_artifact                                   Json?
  deployment_result                               Json?
  runtime_error                                   String?
  build_error                                     String?
  tool_tool_current_tool_message_idTotool_message tool[]   @relation("tool_current_tool_message_idTotool_message")
  tool                                            tool     @relation(fields: [tool_id], references: [id], onDelete: Cascade)
  profile                                         profile? @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tool_page {
  created_at   DateTime   @default(now()) @db.Timestamptz(6)
  name         String?
  tool_id      String     @db.Uuid
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id String?    @db.Uuid
  tool         tool       @relation(fields: [tool_id], references: [id], onDelete: Cascade)
  workspace    workspace? @relation(fields: [workspace_id], references: [id], onDelete: Cascade)

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model workspace {
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  name                 String
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profile_to_workspace profile_to_workspace[]
  tool                 tool[]
  tool_page            tool_page[]
  workspace_database   workspace_database[]

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model workspace_database {
  created_at        DateTime  @default(now()) @db.Timestamptz(6)
  db_type           db_type?
  credential_zipped String?
  id                String    @id(map: "tool_database_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workspace_id      String    @db.Uuid
  nickname          String
  updated_at        DateTime  @default(now()) @db.Timestamptz(6)
  table_sample      Json?
  tool              tool[]
  workspace         workspace @relation(fields: [workspace_id], references: [id], onDelete: Cascade, map: "tool_database_workspace_id_fkey")

  @@schema("public")
}

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model audit_log_entries {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model flow_state {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model identities {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model instances {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model mfa_amr_claims {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model mfa_challenges {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model mfa_factors {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model one_time_tokens {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model refresh_tokens {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model saml_providers {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model saml_relay_states {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model schema_migrations {
// @@schema("auth")
// }

/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
// model sessions {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
// model sso_domains {
// @@schema("auth")
// }

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// We could not retrieve columns for the underlying table. Either it has none or you are missing rights to see them. Please check your privileges.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
// model sso_providers {
// @@schema("auth")
// }

enum aal_level {
  aal1
  aal2
  aal3

  @@schema("auth")
}

enum code_challenge_method {
  s256
  plain

  @@schema("auth")
}

enum factor_status {
  unverified
  verified

  @@schema("auth")
}

enum factor_type {
  totp
  webauthn
  phone

  @@schema("auth")
}

enum one_time_token_type {
  confirmation_token
  reauthentication_token
  recovery_token
  email_change_token_new
  email_change_token_current
  phone_change_token

  @@schema("auth")
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum OnboardingStatus {
  NOT_STARTED
  COMPLETED

  @@schema("public")
}

enum db_type {
  postgresql
  mysql
  sqlite
  mongodb
  firestore
  supabase
  dynamodb
  redis
  oracle
  mariadb
  sqlserver
  cassandra
  cockroachdb
  neon
  planetscale
  elastic
  fauna
  surrealdb
  neptune
  none

  @@schema("public")
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum ToolStatus {
  DEPLOYED
  DRAFT

  @@schema("public")
}

enum TemplateId {
  nextjs14_v1 @map("nextjs14-v1")
  nextjs15_v1 @map("nextjs15-v1")

  @@schema("public")
}
